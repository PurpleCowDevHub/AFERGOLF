<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Carga de Imagen de Perfil</title>
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background: #f5f5f5;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .debug-item {
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
            background: #f9f9f9;
            font-family: monospace;
            word-break: break-all;
        }
        .image-preview {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
        }
        .image-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 4px;
        }
        .status-success {
            color: #2e7d32;
            font-weight: bold;
        }
        .status-error {
            color: #c62828;
            font-weight: bold;
        }
        button {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }
        button:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <h1>üîç Debug: Carga de Imagen de Perfil</h1>
    
    <div class="debug-section">
        <h2>üìã Informaci√≥n del Usuario</h2>
        <div id="userInfo"></div>
        <button onclick="loadUserData()">Cargar Datos</button>
    </div>

    <div class="debug-section">
        <h2>üñºÔ∏è Vista Previa de Imagen</h2>
        <div class="image-preview">
            <img id="previewImage" src="" alt="Previsualizaci√≥n" style="display: none;">
            <p id="previewStatus">Esperando cargar imagen...</p>
        </div>
    </div>

    <div class="debug-section">
        <h2>üìÅ Rutas Evaluadas</h2>
        <div id="pathsDebug"></div>
    </div>

    <script>
        async function loadUserData() {
            const userId = localStorage.getItem('afergolf_user_id');
            
            if (!userId) {
                alert('Por favor, inicia sesi√≥n primero');
                window.location.href = '../views/log_in.html';
                return;
            }

            console.clear();
            console.log('=== DEBUG: Carga de Imagen de Perfil ===');
            console.log('User ID:', userId);

            const url = `http://localhost/AFERGOLF/back/modules/users/api/my_account.php?id=${userId}`;
            console.log('API URL:', url);

            try {
                const response = await fetch(url);
                const data = await response.json();
                
                console.log('Response:', data);

                let html = '<div class="debug-item">';
                html += `<strong>ID:</strong> ${data.user.id}<br>`;
                html += `<strong>Nombre:</strong> ${data.user.nombres} ${data.user.apellidos}<br>`;
                html += `<strong>Email:</strong> ${data.user.email}<br>`;
                html += `<strong>foto_perfil (BD):</strong> <code>${data.user.foto_perfil || 'NULL'}</code><br>`;
                html += '</div>';
                
                document.getElementById('userInfo').innerHTML = html;

                // Procesar rutas
                if (data.user.foto_perfil && data.user.foto_perfil.trim() !== "") {
                    const routesHtml = `
                        <div class="debug-item">
                            <strong>Ruta en BD:</strong><br>
                            <code>${data.user.foto_perfil}</code>
                        </div>
                        <div class="debug-item">
                            <strong>Ruta relativa (desde my_account.html):</strong><br>
                            <code>../${data.user.foto_perfil}</code>
                        </div>
                        <div class="debug-item">
                            <strong>Ruta absoluta (si cargara desde root):</strong><br>
                            <code>/AFERGOLF/${data.user.foto_perfil}</code>
                        </div>
                    `;
                    document.getElementById('pathsDebug').innerHTML = routesHtml;

                    // Intentar cargar la imagen
                    const imagePath = "../" + data.user.foto_perfil;
                    const img = document.getElementById('previewImage');
                    
                    img.onload = () => {
                        console.log('‚úì Imagen cargada exitosamente');
                        document.getElementById('previewStatus').innerHTML = '<span class="status-success">‚úì Imagen cargada correctamente</span>';
                        img.style.display = 'block';
                    };
                    
                    img.onerror = () => {
                        console.error('‚úó Error al cargar imagen:', imagePath);
                        document.getElementById('previewStatus').innerHTML = `<span class="status-error">‚úó Error al cargar: ${imagePath}</span>`;
                    };
                    
                    img.src = imagePath;
                    console.log('Intentando cargar imagen:', imagePath);
                } else {
                    document.getElementById('pathsDebug').innerHTML = '<p class="status-error">No hay foto_perfil en la BD (NULL)</p>';
                }

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('userInfo').innerHTML = `<p class="status-error">Error: ${error.message}</p>`;
            }
        }

        // Cargar autom√°ticamente
        window.addEventListener('load', () => {
            setTimeout(loadUserData, 500);
        });
    </script>
</body>
</html>
